@page "/Users"
@using Microsoft.AspNetCore.SignalR.Client


<h3>Hello Users!</h3>

<ModalDialog @ref="modalDialog" Title="Usuwanie użytkownika" />

<a class="waves-effect waves-light btn" href="/users/new">Add new user</a>

<div>
    <SearchPanel OnSearch="Search" />
</div>

@if (users is null)
{
    <ProgressBar>
        <em>Loading users...</em>
    </ProgressBar>
}
else
{
    <EntityTableTemplate Entities="users">
        <HeaderTemplate>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
            <th></th>
        </HeaderTemplate>
        <RowTemplate Context="user">
            <td><a href="/users/edit/@user.Id">@user.FirstName</a></td>
            <td><a href="/users/edit/@user.Id">@user.LastName</a></td>
            <td>@user.Email</td>
            <td>
                <a href="/users/edit/@user.Id" class="waves-effect waves-light btn">Edit</a>
                <button type="button" class="waves-effect waves-light btn" @onclick="@(()=>Remove(user))">Remove</button>
            </td>
        </RowTemplate>
    </EntityTableTemplate>
}

@code {
    private ModalDialog modalDialog;


    private async Task Search(string searchText)
    {
        var searchCriteria = new UserSearchCriteria { FirstName = searchText };

        users = await Api.GetBySearchCriteriaAsync(searchCriteria);
    }

    private async Task Remove(User user)
    {
        modalDialog.ChildContent = @<p>Czy chcesz usunąć @user.FirstName @user.LastName</p>;
     
        modalDialog.Open();
    }

}